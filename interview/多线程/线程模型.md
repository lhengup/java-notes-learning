# 三种线程模型

## 一对一模型 
 一般直接使用API或系统调用创建的线程均为一对一的线程。一个用户使用的线程就唯一对应一个内核使用的线程。

优点：用户线程具有了和内核线程一致的有点

缺点：1、由于许多操作系统箱子了内核线程数量，因此一对一线程会让用户的线程数量受到限制/2、许多操作系统内核线程调度时，上下文切换的开销较大，导致用户线程的执行效率下降。        

![img](https://img-blog.csdnimg.cn/20190328084043349.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFpZG9uZzE5OTE=,size_16,color_FFFFFF,t_70)

## 多对一模型
多对一模型将多个用户线程映射到一个内核线程上，线程之间的切换由用户的代码来进行。

优点：因此相对于一对一模型，多对一模型的线程切换要快速许多。
 缺点：多对一模型一大问题是，如果其中一个用户线程阻塞，那么所有的线程将都无法执行，因为此时内核里的线程也会随之阻塞。另外，在多处理器系统上，处理器的增多线程性能也不会有明显的帮助。但同时，多对一模型得到的好处是高效的上下文切换和几乎无限制的线程数量。

![img](https://img-blog.csdnimg.cn/20190328084104848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFpZG9uZzE5OTE=,size_16,color_FFFFFF,t_70)

## 多对多模型
![多对多模型](http://c.biancheng.net/uploads/allimg/181105/2-1Q10510160R60.gif)  
多对多模型多路复用多个用户级线程到同样数量或更少数量的内核线程。内核线程的数量可能与特定应用程序或特定机器有关（应用程序在多处理器上比在单处理器上可能分配到更多数量的线程）。

现在我们考虑一下这些设计对并发性的影响。虽然多对一模型允许开发人员创建任意多的用户线程，但是由于内核只能一次调度一个线程，所以并未增加并发性。虽然一对一模型提供了更大的并发性，但是开发人员应小心，不要在应用程序内创建太多线程（有时系统可能会限制创建线程的数量）。

多对多模型没有这两个缺点：开发人员可以创建任意多的用户线程，并且相应内核线程能在多处理器系统上并发执行。而且，当一个线程执行阻塞系统调用时，内核可以调度另一个线程来执行。

多对多模型的一种变种仍然多路复用多个用户级线程到同样数量或更少数量的内核线程，但也允许绑定某个用户线程到一个内核线程。这个变种，有时称为双层模型。  
![双层模型](http://c.biancheng.net/uploads/allimg/181105/2-1Q105101A3191.gif)